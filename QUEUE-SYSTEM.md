# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –°–∏—Å—Ç–µ–º–∞ –û—á–µ—Ä–µ–¥–µ–π

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å **–∫–∏–Ω—É—Ç—å —Ö–æ—Ç—å 1000 —Å–æ–æ–±—â–µ–Ω–∏–π —Å—Ä–∞–∑—É** - —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –±—É–¥–µ—Ç –∏—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ª–∏–º–∏—Ç–æ–≤ –∏ –∑–∞—â–∏—Ç –æ—Ç –±–∞–Ω–∞!

### ‚ú® –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. **–¢—ã –∫–∏–¥–∞–µ—à—å —Å–æ–æ–±—â–µ–Ω–∏—è** - –æ–Ω–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ—á–µ—Ä–µ–¥—å (API —Å—Ä–∞–∑—É –æ—Ç–≤–µ—á–∞–µ—Ç 202)
2. **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**:
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É (rate limit)
   - –î–µ–ª–∞–µ—Ç –ø–µ—Ä–µ—Ä—ã–≤—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥—ã—Ö 5 —Å–æ–æ–±—â–µ–Ω–∏–π (30—Å–µ–∫-2–º–∏–Ω)
   - –≠–º—É–ª–∏—Ä—É–µ—Ç –ø–µ—á–∞—Ç–∞–Ω–∏–µ (–∑–∞–¥–µ—Ä–∂–∫–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞)
   - –°–ª–µ–¥–∏—Ç –∑–∞ –¥–Ω–µ–≤–Ω—ã–º –ª–∏–º–∏—Ç–æ–º (500/1000 —Å–æ–æ–±—â–µ–Ω–∏–π)
   - –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ - –∂–¥–µ—Ç –º–∏–Ω—É—Ç—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç
3. **–ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è** - –æ—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç (–æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ)
```javascript
const res = await fetch("https://ilovesanzhar.click/api/messages/send", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    accountId: "cmifthyt30000pg077z9mcsn2",
    message: "Hello!",
    to: "996500660706",
  }),
});

const data = await res.json();
console.log(data);
// {
//   "success": true,
//   "queued": true,
//   "queuePosition": 1,
//   "queueLength": 1,
//   "dailyCount": 0,
//   "dailyLimit": 500
// }
```

### 2. –ú–∞—Å—Å–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (–≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç)
```bash
node test-queue.js
```

–°–∫—Ä–∏–ø—Ç:
- –ö–∏–¥–∞–µ—Ç 100 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥—å
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è - –∫–∏–¥–∞–π –∏ –∑–∞–±—É–¥—å!

### 3. –¢–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç (1000 —Å–æ–æ–±—â–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
```javascript
for (let i = 0; i < 1000; i++) {
  fetch("https://ilovesanzhar.click/api/messages/send", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      accountId: "cmifthyt30000pg077z9mcsn2",
      message: `Message ${i}`,
      to: "996500660706",
    }),
  });
}
```

**–≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ!** –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ø–∞–¥—É—Ç –≤ –æ—á–µ—Ä–µ–¥—å –∏ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏.

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ—á–µ—Ä–µ–¥–∏

```bash
GET https://ilovesanzhar.click/api/accounts/{accountId}/queue
```

–û—Ç–≤–µ—Ç:
```json
{
  "accountId": "cmifthyt30000pg077z9mcsn2",
  "queueLength": 45,
  "messages": [
    {
      "position": 1,
      "to": "996500660706",
      "message": "Test message #1...",
      "retries": 0
    }
  ],
  "status": {
    "clientStatus": "CONNECTED",
    "isResting": false,
    "messagesSinceRest": 3,
    "restThreshold": 5
  },
  "limits": {
    "dailyCount": 25,
    "dailyLimit": 500,
    "isNewAccount": true
  }
}
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –î–æ (—Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞):
- ‚ùå –ù—É–∂–Ω–æ –±—ã–ª–æ –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚ùå –ü—Ä–∏ rate limit - –æ—à–∏–±–∫–∞ 429
- ‚ùå –ù—É–∂–Ω–æ —Å–∞–º–æ–º—É –¥–µ–ª–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏
- ‚ùå Pending –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ

### ‚úÖ –¢–µ–ø–µ—Ä—å (–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞):
- ‚úÖ –ö–∏–¥–∞–µ—à—å –≤—Å–µ —Å—Ä–∞–∑—É - —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–∏ rate limit - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
- ‚úÖ –í—Å–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –ª–∏–º–∏—Ç—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö pending - –≤—Å–µ –≤ –æ—á–µ—Ä–µ–¥–∏

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (server/index.js)

```javascript
CONFIG = {
  RATE_LIMIT_MAX_MESSAGES: 20,          // 20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É
  DAILY_MESSAGE_LIMIT_NEW_ACCOUNT: 500, // –õ–∏–º–∏—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
  DAILY_MESSAGE_LIMIT_OLD_ACCOUNT: 1000,// –õ–∏–º–∏—Ç –¥–ª—è —Å—Ç–∞—Ä—ã—Ö
  REST_AFTER_MESSAGES: 5,               // –û—Ç–¥—ã—Ö –ø–æ—Å–ª–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π
  REST_DURATION_MIN: 30000,             // 30 —Å–µ–∫
  REST_DURATION_MAX: 120000,            // 2 –º–∏–Ω
  DELAY_BETWEEN_MESSAGES_MIN: 3000,     // 3 —Å–µ–∫ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
  DELAY_BETWEEN_MESSAGES_MAX: 8000,     // 8 —Å–µ–∫
}
```

---

## üî• –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –æ—á–µ—Ä–µ–¥–∏ –≤ –ª–æ–≥–∞—Ö —É–≤–∏–¥–∏—à—å:
```
üì• Message queued for account... (Queue: 100 messages)
üöÄ Starting queue processor for account...
üì§ Processing message for account... (100 in queue)
‚úÖ Message sent (Daily: 25, Session: 3, Queue: 99 remaining)
‚è±Ô∏è  Waiting 5s before next message...
üí§ Account taking a break for 45 seconds after 5 messages (95 messages in queue)
‚ú® Account finished resting, resuming queue...
‚è≥ Rate limit reached. Waiting 45s (90 messages in queue)...
üîÑ Rate limit reset, resuming queue...
üéâ Queue empty for account
```

---

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π —Å–µ—Ä–≤–µ—Ä** - –æ—á–µ—Ä–µ–¥—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
2. **–°–ª–µ–¥–∏ –∑–∞ –ª–æ–≥–∞–º–∏** - —Ç–∞–º –≤–∏–¥–Ω–æ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
3. **–ü—Ä–æ–≤–µ—Ä—è–π —Å—Ç–∞—Ç—É—Å** - –∏—Å–ø–æ–ª—å–∑—É–π `/api/accounts/:id/queue`
4. **–ù–∞—á–Ω–∏ —Å –º–∞–ª–æ–≥–æ** - —Å–Ω–∞—á–∞–ª–∞ 50-100 —Å–æ–æ–±—â–µ–Ω–∏–π, –ø–æ—Ç–æ–º –±–æ–ª—å—à–µ

---

## üéâ –ò—Ç–æ–≥

–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å:
```javascript
// –ö–∏–Ω—É—Ç—å 1000 —Å–æ–æ–±—â–µ–Ω–∏–π
for (let i = 0; i < 1000; i++) {
  fetch(...); // –ë–µ–∑ await!
}
// –ò –∑–∞–±—ã—Ç—å - —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –≤—Å–µ —Å–¥–µ–ª–∞–µ—Ç!
```

**–ù–∏–∫–∞–∫–∏—Ö pending, –Ω–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫, –Ω–∏–∫–∞–∫–æ–≥–æ –±–∞–Ω–∞!** üöÄ
